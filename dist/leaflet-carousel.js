 /* Adam Mertel */

!function(t,e){!function(t,e){L.CarouselMarkerGroup=L.FeatureGroup.extend({options:{maxDist:6e4,noSteps:10,circleSegmentAngle:20,colors:{},propertyName:""},initialize:function(t){L.Util.setOptions(this,t),this.options.distStep=this.options.maxDist/this.options.noSteps,this.options.opacityStep=1/(this.options.maxDist/this.options.distStep),this._carousels=[],L.FeatureGroup.prototype.initialize.call(this,[])},_addCarousel:function(t){var e=t.getLatLng(),i=t.feature.properties,o=L.extend(this.options,{coordinates:e,sequences:i[this.options.propertyName],group:this}),s=L.carouselMarker(o);this._carousels.push(s),this.fire("layeradd",{layer:s})},addLayer:function(t){this.addLayers([t]),this.redraw()},addLayers:function(t){for(var e in t)this._addCarousel(t[e]);this.redraw()},redraw:function(){this._clean(),this._draw()},_clean:function(){console.log("_clean");for(var t in this._carousels)this._carousels[t].clean()},_draw:function(){console.log("_draw");for(var t,e=this.options.distStep,i=this.options.maxDist,o=i/e;o>0;o--){var s=o*e;for(t in this._carousels)this._carousels[t].drawCircle(s)}for(t in this._carousels)L.FeatureGroup.prototype.addLayer.call(this,this._carousels[t])}}),L.carouselMarkerGroup=function(t){return new L.CarouselMarkerGroup(t)},L.CarouselMarker=L.FeatureGroup.extend({options:{},_getOpacity:function(t){return(1/this.options.noSteps*(1-Math.pow(t/this.options.maxDist,1.4))).toPrecision(6)},_makeCircle:function(t,e,i,o){var s=this._getOpacity(t);return L.circle(this.options.coordinates,{startAngle:e,stopAngle:i,radius:t,className:"carousel-sequence",fillColor:o,fillOpacity:s,interactive:!1})},initialize:function(t){L.Util.setOptions(this,t),L.FeatureGroup.prototype.initialize.call(this,[])},clean:function(){this.clearLayers()},drawCircle:function(t){var e;if(1==this.options.sequences.length)e=this.options.colors[this.options.sequences[0]],L.FeatureGroup.prototype.addLayer.call(this,this._makeCircle(t,0,360,e).bringToFront());else for(var i=0;i<360/this.options.circleSegmentAngle;i++){var o=i*this.options.circleSegmentAngle,s=this.options.circleSegmentAngle+o,r=this.options.sequences[i%this.options.sequences.length];e=this.options.colors[r],L.FeatureGroup.prototype.addLayer.call(this,this._makeCircle(t,o,s,e).bringToFront())}}}),L.carouselMarker=function(t){return new L.CarouselMarker(t)},e[""]=t}({},function(){return this}()),e[""]=t}({},function(){return this}());